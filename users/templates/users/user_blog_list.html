
{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen bg-[#FAF9F9] py-10">
  <div class="max-w-3xl mx-auto">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl font-bold text-[#232323] tracking-tight">My Blog Posts</h2>
      <a href="{% url 'user_blog_create' %}" class="get-started-btn">New Post</a>
    </div>
    <div class="rounded-xl shadow-xl bg-white border border-[#BEE3DB] p-8">
      {% if posts %}
        <div class="flex flex-col gap-8">
          {% for post in posts %}
            <div class="rounded-lg border border-[#BEE3DB] bg-[#F6FFF8] p-6 shadow hover:shadow-lg transition">
              <div class="flex flex-wrap justify-between items-center mb-2 gap-2">
                <h3 class="text-xl font-bold text-[#555B6E] mb-0">{{ post.title }}</h3>
                <span class="text-xs px-2 py-1 rounded-full {% if post.published %}bg-[#BEE3DB] text-[#555B6E]{% else %}bg-gray-200 text-gray-500{% endif %}">{% if post.published %}Published{% else %}Draft{% endif %}</span>
              </div>
              <div class="text-sm text-gray-500 mb-2">{{ post.created_at|date:"M d, Y" }}</div>
              <div class="line-clamp-2 text-base mb-2 text-[#232323]">{{ post.content|striptags|truncatewords:20 }}</div>
              <div class="flex flex-wrap gap-2 mt-2">
                {% for tag in post.tags.all %}
                  <span class="bg-[#BEE3DB] text-[#555B6E] px-3 py-1 rounded-full text-xs font-semibold">{{ tag.name }}</span>
                {% endfor %}
              </div>
              <div class="mt-3 flex items-center gap-3">
                {% if post.slug %}
                  <a href="{% url 'blog_detail' slug=post.slug %}" class="text-[#89B0AE] hover:underline text-sm inline-block">View</a>
                {% endif %}
                <a href="{% url 'user_blog_edit' pk=post.pk %}" class="text-[#555B6E] hover:underline text-sm inline-block">Edit</a>
                <form id="tc-del-form-{{ post.pk }}" method="post" action="{% url 'user_blog_delete' pk=post.pk %}" class="inline">
                  {% csrf_token %}
                  <button type="button" data-form-id="tc-del-form-{{ post.pk }}" data-title="{{ post.title|escape }}" class="tc-delete-post-btn text-[#AF4448] hover:underline text-sm">Delete</button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center text-[#555B6E] text-lg">You haven't written any blog posts yet.</div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Styled delete confirm modal -->
<div id="tc-confirm-overlay" class="fixed inset-0 bg-black/40 hidden z-[650]">
  <div class="tc-modal-panel max-w-md mx-auto my-24 bg-white rounded-xl shadow border border-[#BEE3DB] overflow-hidden">
    <div class="px-4 py-3 border-b border-[#BEE3DB] flex items-center justify-between">
      <div class="font-semibold text-[#555B6E]">Delete post?</div>
      <button type="button" id="tc-confirm-close" class="text-[#555B6E]">✕</button>
    </div>
    <div class="p-4 text-[#555B6E]">
      Are you sure you want to delete “<span id="tc-confirm-title" class="font-semibold"></span>”? This action cannot be undone.
    </div>
    <div class="px-4 py-3 border-t border-[#BEE3DB] bg-[#F6FFF8] flex items-center justify-end gap-2">
      <button type="button" id="tc-confirm-cancel" class="px-4 py-2 rounded border border-[#BEE3DB] text-[#555B6E]">Cancel</button>
      <button type="button" id="tc-confirm-ok" class="px-4 py-2 rounded border border-[#AF4448] bg-[#AF4448] text-white font-semibold">Delete</button>
    </div>
  </div>
  </div>
<script>
  (function(){
    var overlay = document.getElementById('tc-confirm-overlay');
    var titleEl = document.getElementById('tc-confirm-title');
    var btnOk = document.getElementById('tc-confirm-ok');
    var btnCancel = document.getElementById('tc-confirm-cancel');
    var btnClose = document.getElementById('tc-confirm-close');
    var currentForm = null;
    function lock(){ document.documentElement.style.overflow='hidden'; document.body.style.overflow='hidden'; }
    function unlock(){ document.documentElement.style.overflow=''; document.body.style.overflow=''; }
    function open(title, form){ currentForm = form; if(titleEl) titleEl.textContent = title||''; if(overlay){ overlay.classList.remove('hidden'); lock(); } }
    function close(){ if(overlay){ overlay.classList.add('hidden'); unlock(); } currentForm=null; }
    document.querySelectorAll('.tc-delete-post-btn').forEach(function(btn){
      btn.addEventListener('click', function(){
        var id = btn.getAttribute('data-form-id');
        var title = btn.getAttribute('data-title') || '';
        var form = id ? document.getElementById(id) : btn.closest('form');
        open(title, form);
      });
    });
    if(btnCancel) btnCancel.addEventListener('click', close);
    if(btnClose) btnClose.addEventListener('click', close);
    if(overlay) overlay.addEventListener('click', function(e){ if(e.target===overlay) close(); });
    if(btnOk){
      btnOk.addEventListener('click', function(){
        if(!currentForm) return; btnOk.disabled=true; try{ currentForm.submit(); } finally { btnOk.disabled=false; }
      });
    }
    document.addEventListener('keydown', function(e){ if(e.key==='Escape' && overlay && !overlay.classList.contains('hidden')) close(); });
  })();
</script>
{% endblock %}

