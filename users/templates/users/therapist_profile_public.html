{% extends 'base.html' %}
{% load static therapist_extras %}
{% block title %}{{ profile_obj.first_name }} {{ profile_obj.last_name }} | Therapist Profile{% endblock %}
{% block meta %}
<meta name="description" content="Therapist profile for {{ profile_obj.first_name }} {{ profile_obj.last_name }} offering {{ profile_obj.therapy_delivery_method|default:'therapy services' }} in {{ profile_obj.locations.first.city }}, {{ profile_obj.locations.first.state }}.">
<link rel="canonical" href="{{ request.build_absolute_uri }}" />
{% endblock %}
{% block content %}
<div class="bg-[#FAF9F9] py-10">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex flex-col md:flex-row gap-10">
      <div class="md:w-72 flex flex-col items-center gap-4">
        {% if profile_obj.profile_photo %}
          <img src="{{ profile_obj.profile_photo.url }}" alt="{{ profile_obj.first_name }} {{ profile_obj.last_name }}" class="w-48 h-48 rounded-full object-cover shadow" loading="lazy" />
        {% endif %}
        <div class="text-center">
          <h1 class="text-3xl font-extrabold text-[#555B6E]">{{ profile_obj.first_name }} {{ profile_obj.last_name }}</h1>
          {% if profile_obj.license_type %}<div class="text-sm text-[#116466] font-semibold mt-1">{{ profile_obj.license_type.name }}</div>{% endif %}
          {% if profile_obj.license_type and profile_obj.license_type.description %}<div class="text-xs text-[#89B0AE]">{{ profile_obj.license_type.description }}</div>{% endif %}
        </div>
      </div>
      <div class="flex-1">
        <div class="space-y-10">
          <!-- Personal Statements -->
          {% if profile_obj.personal_statement_q1 %}
          <div class="text-base md:text-lg leading-relaxed whitespace-pre-line text-[#555B6E]">{{ profile_obj.personal_statement_q1 }}</div>
          {% endif %}
          {% if profile_obj.personal_statement_q2 %}
          <div class="text-base md:text-lg leading-relaxed whitespace-pre-line text-[#555B6E]">{{ profile_obj.personal_statement_q2 }}</div>
          {% endif %}
          {% if profile_obj.personal_statement_q3 %}
          <div class="text-base md:text-lg leading-relaxed whitespace-pre-line text-[#555B6E]">{{ profile_obj.personal_statement_q3 }}</div>
          {% endif %}
          <!-- Image Gallery -->
          {% if profile_obj.gallery_images.all %}
          {% with imgs=profile_obj.gallery_images.all %}
          {% if imgs %}
          <div>
            <h2 class="text-xl font-bold text-[#555B6E] mb-4">My Images</h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
              {% for gi in imgs %}
              <figure class="relative group rounded-lg overflow-hidden ring-1 ring-[#BEE3DB] bg-white shadow">
                <img src="{{ gi.image.url }}" alt="{{ gi.caption }}" class="w-full h-40 object-cover transition-transform duration-300 group-hover:scale-105" loading="lazy" />
                {% if gi.caption %}<figcaption class="absolute bottom-0 inset-x-0 bg-black/50 text-white text-[11px] px-2 py-1 line-clamp-2">{{ gi.caption }}</figcaption>{% endif %}
              </figure>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          {% endwith %}
          {% endif %}
          <!-- Video Gallery -->
          {% if profile_obj.video_gallery.all %}
          {% with vids=profile_obj.video_gallery.all %}
          {% if vids %}
          <div>
            <h2 class="text-xl font-bold text-[#555B6E] mb-4">Videos</h2>
            <div class="grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
              {% for vid in vids %}
              <figure class="flex flex-col gap-2 group">
                <div class="relative w-full overflow-hidden bg-black aspect-video rounded-lg ring-1 ring-[#BEE3DB] shadow">
                  <video src="{{ vid.video.url }}" controls preload="none" class="w-full h-full object-cover"></video>
                </div>
                {% if vid.caption %}<figcaption class="text-[11px] text-[#555B6E]">{{ vid.caption }}</figcaption>{% endif %}
              </figure>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          {% endwith %}
          {% endif %}
          <!-- Locations & Office Hours -->
          <div>
            <h2 class="text-xl font-bold text-[#555B6E] mb-4">Locations & Office Hours</h2>
            <div class="space-y-6">
              {% for loc in profile_obj.locations.all %}
              <div class="border border-[#BEE3DB] rounded-xl p-4 flex flex-col md:flex-row gap-6">
                <div class="flex-1">
                  <div class="font-semibold text-[#116466]">{{ loc.practice_name|default:'Practice Location' }}{% if loc.is_primary_address %} (Primary){% endif %}</div>
                  <div class="text-sm text-[#555B6E]">{{ loc.street_address }}{% if loc.address_line_2 %}, {{ loc.address_line_2 }}{% endif %}</div>
                  <div class="text-sm text-[#555B6E]">{{ loc.city }}, {{ loc.state }} {{ loc.zip }}</div>
                  <div class="mt-3 h-52 rounded-lg overflow-hidden ring-1 ring-[#BEE3DB] bg-[#F8FDFC] flex items-center justify-center text-xs text-[#555B6E]">Map placeholder</div>
                </div>
                <div class="w-full md:w-60 md:ml-auto flex flex-col">
                  {% if loc.office_hours.all %}
                  <div class="space-y-1 mb-2">
                    <div class="font-semibold text-[#116466] text-sm tracking-wide uppercase">Office Hours</div>
                    <div class="grid grid-cols-2 gap-x-3 gap-y-1 text-[13px] leading-snug tracking-wide">
                      {% for oh in loc.office_hours.all %}
                        <div class="col-span-2 flex justify-between">
                          <span class="font-semibold text-[#116466]">
                            {% if oh.weekday == 0 %}Mon{% elif oh.weekday == 1 %}Tue{% elif oh.weekday == 2 %}Wed{% elif oh.weekday == 3 %}Thu{% elif oh.weekday == 4 %}Fri{% elif oh.weekday == 5 %}Sat{% else %}Sun{% endif %}
                          </span>
                          <span class="text-right">
                            {% if oh.by_appointment_only %}By appointment{% elif oh.is_closed %}Closed{% else %}
                              {% if oh.start_time_1 and oh.end_time_1 %}{{ oh.start_time_1|to_ampm }} - {{ oh.end_time_1|to_ampm }}{% endif %}{% if oh.start_time_2 and oh.end_time_2 %}{% if oh.start_time_1 and oh.end_time_1 %}, {% endif %}{{ oh.start_time_2|to_ampm }} - {{ oh.end_time_2|to_ampm }}{% endif %}{% if oh.notes %} ({{ oh.notes }}){% endif %}
                            {% endif %}
                          </span>
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                  {% endif %}
                  <div class="mt-auto flex flex-wrap gap-3 text-xs pt-1">
                    <a href="https://www.google.com/maps/search/?api=1&query={{ loc.street_address|urlencode }}+{{ loc.city|urlencode }}+{{ loc.state|urlencode }}+{{ loc.zip|urlencode }}" target="_blank" rel="noopener" class="underline text-[#116466] font-semibold">Open in Maps</a>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
