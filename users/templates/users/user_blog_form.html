{% extends 'base.html' %}
{% block content %}
<div class="max-w-2xl mx-auto py-10">
  <h2 class="text-2xl font-bold text-[#555B6E] mb-6">New Blog Post</h2>
  <form method="post" enctype="multipart/form-data" class="bg-white rounded-xl shadow p-8 border border-[#BEE3DB] flex flex-col gap-6">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div>
      <label class="block text-sm font-medium text-[#555B6E] mb-1">Title</label>
      {{ form.title }}
      {{ form.title.errors }}
    </div>
    <div>
      <label class="block text-sm font-medium text-[#555B6E] mb-1">Attach Media (up to 8)</label>
      <input type="file" name="media" multiple accept="image/*,video/*" class="border border-gray-300 rounded px-3 py-2 w-full bg-[#FAF9F9] text-[#555B6E]" />
      <input type="hidden" name="media_meta" id="blog-form-media-meta" value="{}" />
      <div id="blog-form-media-preview" class="mt-2 grid grid-cols-3 gap-2"></div>
      <p class="text-xs text-[#555B6E]/70 mt-1">Tip: to place media inline in your article, insert tokens like <code class="px-1 rounded bg-[#F6FFF8] border border-[#BEE3DB]">[[media:1]]</code> where you want the first attached item to appear, <code class="px-1 rounded bg-[#F6FFF8] border border-[#BEE3DB]">[[media:2]]</code> for the second, etc.</p>
    </div>
    <div>
      <label class="block text-sm font-medium text-[#555B6E] mb-1">Content</label>
      {{ form.content }}
      {{ form.content.errors }}
    </div>
    <div>
      <label class="block text-sm font-medium text-[#555B6E] mb-1">Image</label>
      {{ form.image }}
      {{ form.image.errors }}
    </div>
    <div>
      <label class="block text-sm font-medium text-[#555B6E] mb-1">Tags</label>
      {{ form.tags }}
      {{ form.tags.errors }}
    </div>
    <div>
      <label class="block text-sm font-medium text-[#555B6E] mb-1">Visibility</label>
      {{ form.visibility }}
      <p class="text-xs text-[#555B6E]/70 mt-1">Public: visible on the public blog. Members: visible to logged-in members only.</p>
      {{ form.visibility.errors }}
    </div>
    <div class="flex items-center gap-2">
      {{ form.published }}
      <label class="text-sm text-[#555B6E]">Publish</label>
    </div>
    <button type="submit" class="px-6 py-2 rounded font-semibold text-sm bg-[#89B0AE] text-white hover:bg-[#555B6E]">Save Post</button>
  </form>
</div>
<script>
(function(){
  const input = document.querySelector('input[name="media"][multiple]');
  const preview = document.getElementById('blog-form-media-preview');
  function render(){ if (!input || !preview) return; const files = input.files ? Array.from(input.files) : []; preview.innerHTML=''; files.slice(0,8).forEach(f=>{ const url = URL.createObjectURL(f); const wrap = document.createElement('div'); wrap.className='relative border border-[#E6F2F0] rounded overflow-hidden'; wrap.style.height='90px'; if ((f.type||'').startsWith('video/')) wrap.innerHTML = `<video src="${url}" class="w-full h-full object-cover" muted></video>`; else wrap.innerHTML = `<img src="${url}" class="w-full h-full object-cover" alt=""/>`; preview.appendChild(wrap); }); }
  input && input.addEventListener('change', render);
})();
</script>
{% endblock %}
