{% load location_extras %}
{# Redesigned Therapist Card: Portrait image column + content + chips + distance overlay #}
<div x-data="{}" class="relative rounded-2xl shadow-lg mb-10 mx-auto overflow-hidden flex flex-col md:flex-row md:h-[360px]" style="background-color:#FAF9F9; color:#555B6E; width:80%; min-width:280px; max-width:1100px;">
  {# IMAGE COLUMN (reduced size) #}
  <div class="relative w-full md:w-1/4 md:max-w-[260px] flex md:block md:h-full">
    {% comment %}Image fills column height via flex + object-cover. Use a wrapper to constrain max height to avoid extreme portrait stretching.{% endcomment %}
  <div class="w-full h-56 md:h-full md:min-h-full overflow-hidden">
      {% if therapist.profile_photo %}
  <img src="{{ therapist.profile_photo.url }}" alt="Portrait of {{ therapist.first_name }} {{ therapist.last_name }}" class="w-full h-full object-cover object-center md:rounded-l-2xl" style="min-height:100%;" />
      {% else %}
  <img src="https://randomuser.me/api/portraits/lego/1.jpg" alt="Placeholder portrait for {{ therapist.first_name }} {{ therapist.last_name }}" class="w-full h-full object-cover object-center md:rounded-l-2xl" style="min-height:100%;" />
      {% endif %}
    </div>
    {% if therapist.distance is not None %}
      <span class="absolute top-3 left-3 bg-[#F5E2D6] text-[#555B6E] px-3 py-1 rounded-full text-xs font-semibold shadow-sm border border-[#FF9950]/30" style="box-shadow:0 2px 4px rgba(0,0,0,0.1);">Approx. {{ therapist.distance }} miles</span>
    {% endif %}
  </div>

  {# CONTENT COLUMN #}
  <div class="flex-1 flex flex-col p-6 sm:p-10 md:p-8 gap-4">
    <div>
      <h3 class="text-2xl font-extrabold flex flex-wrap items-baseline gap-x-2 leading-snug" style="color:#555B6E;">
        <span>{{ therapist.first_name }} {{ therapist.last_name }}</span>
        {% if therapist.license_type %}<span class="text-base font-semibold" style="color:#116466;">{{ therapist.license_type.name }}</span>{% endif %}
      </h3>
      {% with primary=therapist.locations.all|get_primary_location %}
        {% if primary and primary.practice_name %}
          <div class="text-sm font-semibold mt-0.5">{{ primary.practice_name }}</div>
        {% endif %}
        <div class="text-xs opacity-80">
          {% if primary %}{{ primary.city }}, {{ primary.state }}{% endif %}
        </div>
      {% endwith %}
      {% if therapist.credentials_note %}
        <div class="mt-2 text-sm font-medium" style="color:#89B0AE;">{{ therapist.credentials_note }}</div>
      {% endif %}
    </div>

    {# CHIP GROUPS #}
    <div class="flex flex-wrap gap-2 text-xs">
      {% for pt in therapist.participant_types.all %}
        <span class="px-2 py-1 rounded-full bg-[#BEE3DB] text-[#444] font-semibold shadow-sm">{{ pt.name }}</span>
      {% endfor %}
      {% for ag in therapist.age_groups.all %}
        <span class="px-2 py-1 rounded-full bg-[#E5F4F2] text-[#444] font-medium shadow-sm">{{ ag.name }}</span>
      {% endfor %}
      {% for spec in therapist.specialties.all %}{% if spec.is_top_specialty %}
        <span class="px-2 py-1 rounded-full bg-[#FFDDD0] text-[#444] font-medium shadow-sm">{{ spec.specialty.name }}</span>
      {% endif %}{% endfor %}
    </div>

    {# INTRO SNIPPET: uses intro_statement first, then personal_statement_q1 #}
    {% if therapist.intro_statement %}
      <div class="text-sm leading-relaxed max-h-28 overflow-hidden relative" style="mask-image:linear-gradient(to bottom,black 70%,transparent 100%);">
        {{ therapist.intro_statement|truncatechars:350 }}
      </div>
    {% elif therapist.personal_statement_q1 %}
      <div class="text-sm leading-relaxed max-h-28 overflow-hidden relative" style="mask-image:linear-gradient(to bottom,black 70%,transparent 100%);">
        {{ therapist.personal_statement_q1|truncatechars:350 }}
      </div>
    {% endif %}

    <div class="mt-auto flex flex-wrap items-center gap-4 pt-2">
      <button
        type="button"
        class="get-started-btn font-semibold rounded-lg px-5 py-2.5 cursor-pointer bg-[#116466] text-white hover:bg-[#0d4c4d] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#89B0AE] transition"
        @click="$store.profileModal.open({{ therapist.user.id }})"
      >View Profile</button>
  {# Distance pill duplicated previously; now only shown over image #}
    </div>
  </div>
</div>

