{% load static tailwind_tags %}
<link href="{% static 'css/dist/styles.css' %}" rel="stylesheet">
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Therapy Connected</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    {% tailwind_css %}
    <!-- Alpine.js for Combobox functionality -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-50 text-black font-serif leading-normal tracking-normal">
    <!-- Modals now included only in home.html; all showModal logic removed -->
    <!-- Header -->
    <div class="min-h-screen flex flex-col">
    <header class="shadow-sm sticky top-0 z-20" style="background-color: #FAF9F9;">
        <style>
        .nav-link {
            transition: color 0.2s;
        }
        .nav-link:hover {
            color: #FF9950 !important;
        }
        .signup-btn {
            transition: background 0.2s, color 0.2s;
        }
        .signup-btn:hover {
            color: #555B6E !important;
        }
        </style>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative flex flex-col lg:flex-row items-center h-auto lg:h-16 py-2 lg:py-0">
            <!-- Logo and mobile menu button -->
            <div class="flex w-full lg:w-auto items-center justify-between lg:justify-start">
                <div class="flex items-center gap-4">
                    <a href="/" class="text-2xl font-bold" style="color: #555B6E;">Therapy Connected</a>
                    <!-- Compact ZIP control -->
                    <div x-data="{open:false,newZip:'',error:'',saving:false, submit(){this.error=''; if(!/^\d{5}$/.test(this.newZip)){ this.error='Enter 5 digit ZIP'; return;} this.saving=true; fetch(`/set_zip/?zip=${this.newZip}`).then(r=>r.json()).then(d=>{ if(d.status==='ok'){ window.location.reload(); } else { this.error='Could not update'; } }).catch(()=> this.error='Network error').finally(()=> this.saving=false); }}" class="relative hidden md:block">
                        <button type="button" @click="open=!open; if(open){ $nextTick(()=> $refs.zipInput.focus()) }" class="flex items-center gap-1 text-sm font-medium px-2 py-1 rounded hover:bg-[#BEE3DB] focus:outline-none focus:ring-2 focus:ring-[#89B0AE]" :aria-expanded="open.toString()" aria-haspopup="dialog" style="color:#555B6E;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/></svg>
                            <span class="font-semibold">
                                {% if user_zip_city and user_zip_state %}
                                    {{ user_zip_city }}, {{ user_zip_state }}
                                {% elif user_zip %}
                                    {{ user_zip }}
                                {% else %}
                                    Set Location
                                {% endif %}
                            </span>
                        </button>
                        <div x-cloak x-show="open" x-transition @click.outside="open=false" class="absolute left-0 mt-2 w-60 bg-white border rounded shadow-lg p-4 z-30" style="border-color:#89B0AE;">
                            <h3 class="text-xs font-semibold mb-2 tracking-wide" style="color:#555B6E;">Change ZIP Code</h3>
                            <form @submit.prevent="submit()" class="space-y-2">
                                <input x-ref="zipInput" x-model="newZip" type="text" inputmode="numeric" maxlength="5" placeholder="ZIP" aria-label="ZIP code" class="w-full border rounded px-3 py-2 text-sm focus:ring-2" style="border-color:#89B0AE; color:#555B6E; background:#FAF9F9;" />
                                <button type="button" @click="open=false; error=''; if(typeof setZipFromGeolocation==='function'){ setZipFromGeolocation(true); } else { error='Function not available'; }" class="text-xs underline font-medium" style="color:#89B0AE;">Use my location</button>
                                <div class="flex gap-2 justify-end">
                                    <button type="button" @click="open=false; newZip=''; error=''" class="px-3 py-1 text-xs font-medium rounded" style="background:#BEE3DB; color:#555B6E;">Cancel</button>
                                    <button type="submit" :disabled="saving" class="px-3 py-1 text-xs font-semibold rounded" :class="saving ? 'opacity-60 cursor-not-allowed' : ''" style="background:#89B0AE; color:#FAF9F9;" x-text="saving ? 'Saving...' : 'Save'"></button>
                                </div>
                                <p x-show="error" x-text="error" class="text-xs font-semibold" style="color:#FF4D4F;"></p>
                                <p class="text-[10px] mt-1" style="color:#555B6E;">Current: <strong>
                                    {% if user_zip_city and user_zip_state %}
                                        {{ user_zip_city }}, {{ user_zip_state }} ({{ user_zip }})
                                    {% elif user_zip %}
                                        {{ user_zip }}
                                    {% else %}
                                        (none)
                                    {% endif %}
                                </strong></p>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Mobile menu button -->
                <button id="mobile-menu-btn" class="lg:hidden p-2 rounded focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#89B0AE] ml-2" aria-label="Open navigation">
                    <svg class="h-6 w-6 text-[#555B6E]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
            </div>
    
            <!-- Desktop nav centered via flex (prevents overlap with ZIP control) -->
            <nav class="hidden lg:flex flex-1 justify-center items-center gap-6">
                <a href="/" class="font-medium nav-link{% if request.path == '/' %} active-nav{% endif %}" style="color: {% if request.path == '/' %}#FF9950{% else %}#555B6E{% endif %};">Home</a>
                <a href="/therapists/" class="font-medium nav-link{% if request.path|slice:':12' == '/therapists/' %} active-nav{% endif %}" style="color: {% if request.path|slice:':12' == '/therapists/' %}#FF9950{% else %}#555B6E{% endif %};">Therapists</a>
                <a href="{% url 'blog_index' %}" class="font-medium nav-link{% if request.path|slice:':6' == '/blog/' %} active-nav{% endif %}" style="color: {% if request.path|slice:':6' == '/blog/' %}#FF9950{% else %}#555B6E{% endif %};">Blog</a>
                <a href="/features/" class="font-medium nav-link{% if request.path|slice:':9' == '/features' %} active-nav{% endif %}" style="color: {% if request.path|slice:':9' == '/features' %}#FF9950{% else %}#555B6E{% endif %};">Features</a>
                <a href="/pricing/" class="font-medium nav-link{% if request.path|slice:':8' == '/pricing' %} active-nav{% endif %}" style="color: {% if request.path|slice:':8' == '/pricing' %}#FF9950{% else %}#555B6E{% endif %};">Pricing</a>
                <a href="/about/" class="font-medium nav-link{% if request.path|slice:':6' == '/about' %} active-nav{% endif %}" style="color: {% if request.path|slice:':6' == '/about' %}#FF9950{% else %}#555B6E{% endif %};">About</a>
            </nav>
            <div class="hidden lg:flex items-center space-x-2 lg:space-x-4 ml-auto">
                {% if request.user.is_authenticated %}
                    <a href="/users/logout/" class="text-sm font-medium" style="color: #89B0AE;">Logout</a>
                    {% if request.path != '/users/profile-wizard/' %}
                        <a href="/users/dashboard/" class="get-started-btn px-4 py-2 rounded font-semibold text-sm">Dashboard</a>
                    {% endif %}
                {% else %}
                    <a href="/users/login/" class="text-sm font-medium" style="color: #89B0AE;">Login</a>
                    {% if request.path != '/users/register/' %}
                        <a href="/subscribe/" class="get-started-btn px-4 py-2 rounded font-semibold text-sm signup-btn">Get Started</a>
                    {% endif %}
                {% endif %}
            </div>
            <!-- Mobile nav dropdown -->
            <div id="mobile-menu" class="lg:hidden hidden w-full mt-2">
                <nav class="flex flex-col gap-2 bg-white rounded shadow p-4 items-center text-center">
                    <!-- Mobile ZIP control -->
                    <div x-data="{open:false,newZip:'',error:'',saving:false, submit(){this.error=''; if(!/^\d{5}$/.test(this.newZip)){ this.error='Enter 5 digit ZIP'; return;} this.saving=true; fetch(`/set_zip/?zip=${this.newZip}`).then(r=>r.json()).then(d=>{ if(d.status==='ok'){ window.location.reload(); } else { this.error='Could not update'; } }).catch(()=> this.error='Network error').finally(()=> this.saving=false); }}" class="w-full mb-2">
                        <button type="button" @click="open=!open; if(open){ $nextTick(()=> $refs.mZip.focus()) }" class="w-full flex items-center justify-center gap-1 text-sm font-medium px-2 py-2 rounded border" style="border-color:#89B0AE; color:#555B6E;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/></svg>
                            <span>
                                {% if user_zip_city and user_zip_state %}
                                    {{ user_zip_city }}, {{ user_zip_state }}
                                {% elif user_zip %}
                                    {{ user_zip }}
                                {% else %}
                                    Set Location
                                {% endif %}
                            </span>
                        </button>
                        <div x-cloak x-show="open" class="mt-2 text-left">
                            <form @submit.prevent="submit()" class="space-y-2">
                                <input x-ref="mZip" x-model="newZip" type="text" inputmode="numeric" maxlength="5" placeholder="ZIP" aria-label="ZIP code" class="w-full border rounded px-3 py-2 text-sm" style="border-color:#89B0AE; color:#555B6E; background:#FAF9F9;" />
                                <button type="button" @click="open=false; error=''; if(typeof setZipFromGeolocation==='function'){ setZipFromGeolocation(true); } else { error='Function not available'; }" class="text-xs underline font-medium" style="color:#89B0AE;">Use my location</button>
                                <div class="flex gap-2 justify-end">
                                    <button type="button" @click="open=false; newZip=''; error=''" class="px-3 py-1 text-xs font-medium rounded" style="background:#BEE3DB; color:#555B6E;">Cancel</button>
                                    <button type="submit" :disabled="saving" class="px-3 py-1 text-xs font-semibold rounded" :class="saving ? 'opacity-60 cursor-not-allowed' : ''" style="background:#89B0AE; color:#FAF9F9;" x-text="saving ? 'Saving...' : 'Save'"></button>
                                </div>
                                <p x-show="error" x-text="error" class="text-xs font-semibold" style="color:#FF4D4F;"></p>
                            </form>
                        </div>
                    </div>
                    <a href="/" class="font-medium nav-link{% if request.path == '/' %} active-nav{% endif %}" style="color: {% if request.path == '/' %}#FF9950{% else %}#555B6E{% endif %};">Home</a>
                    <a href="/therapists/" class="font-medium nav-link{% if request.path|slice:':12' == '/therapists/' %} active-nav{% endif %}" style="color: {% if request.path|slice:':12' == '/therapists/' %}#FF9950{% else %}#555B6E{% endif %};">Therapists</a>
                    <a href="{% url 'blog_index' %}" class="font-medium nav-link{% if request.path|slice:':6' == '/blog/' %} active-nav{% endif %}" style="color: {% if request.path|slice:':6' == '/blog/' %}#FF9950{% else %}#555B6E{% endif %};">Blog</a>
                    <a href="#" class="font-medium nav-link" style="color: #555B6E;">Features</a>
                    <a href="#" class="font-medium nav-link" style="color: #555B6E;">Pricing</a>
                    <a href="#" class="font-medium nav-link" style="color: #555B6E;">About</a>
                    <div class="flex flex-col gap-2 mt-2">
                        {% if request.user.is_authenticated %}
                            <a href="/users/logout/" class="text-sm font-medium" style="color: #89B0AE;">Logout</a>
                            {% if request.path != '/users/profile-wizard/' %}
                                <a href="/users/profile/" class="px-4 py-2 rounded font-semibold text-sm text-center signup-btn" style="background-color: #FF9950; color: #fff;">Profile</a>
                                <a href="/users/profile/" class="get-started-btn px-4 py-2 rounded font-semibold text-sm text-center signup-btn">Profile</a>
                            {% endif %}
                        {% else %}
                            <a href="/users/login/" class="text-sm font-medium" style="color: #89B0AE;">Login</a>
                            {% if request.path != '/users/register/' %}
                                <a href="/subscribe/" class="get-started-btn px-4 py-2 rounded font-semibold text-sm text-center signup-btn">Get Started</a>
                            {% endif %}
        <style>
          .get-started-btn {
            background-color: #89B0AE;
            color: #fff;
            transition: background 0.2s, color 0.2s;
          }
          .get-started-btn:hover, .get-started-btn:focus {
            background-color: #555B6E !important;
            color: #fff !important;
          }
        </style>
                        {% endif %}
                    </div>
                </nav>
            </div>
        <script>
        // Simple mobile nav toggle
        document.addEventListener('DOMContentLoaded', function() {
            var btn = document.getElementById('mobile-menu-btn');
            var menu = document.getElementById('mobile-menu');
            if (btn && menu) {
                btn.addEventListener('click', function() {
                    menu.classList.toggle('hidden');
                });
            }
        });
        </script>
    </header>
    <main class="flex-1 flex flex-col">
        {% block content %}{% endblock %}
    </main>
    {% include "footer.html" %}
    </div>
    <!-- Global site JS (modal logic + geolocation ZIP helper) -->
    <script src="{% static 'home.js' %}"></script>
</body>
</html>
